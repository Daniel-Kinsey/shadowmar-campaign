<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronicles of Shadowmar - D&D Campaign</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <h1>‚öîÔ∏è Chronicles of Shadowmar</h1>
                <div class="header-controls">
                    <span id="username-display">{{ session.username }}</span>
                    <span class="role-badge" id="role-badge">{{ session.role }}</span>
                    <button id="logout-btn" class="btn btn-secondary">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Tab Navigation -->
                <nav class="tabs">
                    <button class="tab-btn active" data-tab="characters">Characters</button>
                    <button class="tab-btn" data-tab="campaign">Campaign</button>
                    <button class="tab-btn" data-tab="chat">Chat</button>
                    <button class="tab-btn" data-tab="files">Files</button>
                    <button class="tab-btn" data-tab="combat">‚öîÔ∏è Combat</button>
                    <button class="tab-btn" data-tab="battlemap">üó∫Ô∏è Battle Map</button>
                    <button class="tab-btn" data-tab="dm-book">üìñ DM Book</button>
                </nav>

                <!-- Characters Tab -->
                <div id="characters-tab" class="tab-content active">
                    <div class="tab-header">
                        <h2>Characters</h2>
                        <button id="add-character-btn" class="btn btn-primary">üìã Create Character Sheet</button>
                    </div>
                    
                    <div id="characters-grid" class="characters-grid">
                        <!-- Characters will be loaded here -->
                    </div>
                </div>

                <!-- Campaign Tab -->
                <div id="campaign-tab" class="tab-content">
                    <div class="tab-header">
                        <h2>Campaign Information</h2>
                    </div>
                    
                    <div class="campaign-sections">
                        <div class="campaign-section">
                            <h3>Current Location</h3>
                            <div class="editable-field" data-field="location">
                                <span class="field-content">Loading...</span>
                                <button class="edit-btn">Edit</button>
                            </div>
                        </div>
                        
                        <div class="campaign-section">
                            <h3>Session Notes</h3>
                            <div class="editable-field" data-field="session_notes">
                                <div class="field-content">Loading...</div>
                                <button class="edit-btn">Edit</button>
                            </div>
                        </div>
                        
                        <div class="campaign-section">
                            <h3>Important NPCs</h3>
                            <div class="editable-field" data-field="npcs">
                                <div class="field-content">Loading...</div>
                                <button class="edit-btn">Edit</button>
                            </div>
                        </div>
                        
                        <div class="campaign-section">
                            <h3>Treasure & Loot</h3>
                            <div class="editable-field" data-field="treasure">
                                <div class="field-content">Loading...</div>
                                <button class="edit-btn">Edit</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Tab -->
                <div id="chat-tab" class="tab-content">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h3>Campaign Chat</h3>
                            <div class="chat-controls">
                                <button id="secret-message-btn" class="btn btn-secondary btn-small">üìú Secret Message</button>
                                <button id="dice-roll-btn" class="btn btn-secondary btn-small">üé≤ Roll Dice</button>
                            </div>
                        </div>
                        
                        <div id="chat-messages" class="chat-messages">
                            <!-- Messages will be loaded here -->
                        </div>
                        
                        <div class="chat-input-container">
                            <input type="text" id="chat-input" placeholder="Type your message..." maxlength="500">
                            <button id="send-message" class="btn btn-primary">Send</button>
                        </div>
                    </div>

                    <!-- Quick Dice Panel -->
                    <div id="quick-dice-panel" class="quick-dice-panel" style="display: none;">
                        <div class="dice-controls">
                            <div class="form-group">
                                <label for="dice-type">Dice</label>
                                <select id="dice-type">
                                    <option value="d4">d4</option>
                                    <option value="d6">d6</option>
                                    <option value="d8">d8</option>
                                    <option value="d10">d10</option>
                                    <option value="d12">d12</option>
                                    <option value="d20" selected>d20</option>
                                    <option value="d100">d100</option>
                                    <option value="2d6">2d6</option>
                                    <option value="3d6">3d6</option>
                                    <option value="4d6">4d6</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="dice-modifier">Modifier</label>
                                <input type="number" id="dice-modifier" value="0" min="-10" max="20">
                            </div>
                            
                            <div class="form-group">
                                <label for="dice-reason">Reason</label>
                                <input type="text" id="dice-reason" placeholder="Attack roll, etc.">
                            </div>
                            
                            <button id="roll-dice" class="btn btn-primary">Roll</button>
                        </div>
                    </div>
                </div>

                <!-- Files Tab -->
                <div id="files-tab" class="tab-content">
                    <div class="tab-header">
                        <h2>Campaign Files</h2>
                        <div class="file-upload-container">
                            <input type="file" id="file-input" accept=".txt,.pdf,.png,.jpg,.jpeg,.gif,.doc,.docx" style="display: none;">
                            <button id="upload-btn" class="btn btn-primary">Upload File</button>
                        </div>
                    </div>
                    
                    <div id="files-list" class="files-list">
                        <!-- Files will be loaded here -->
                    </div>
                </div>

                <!-- Combat Tab -->
                <div id="combat-tab" class="tab-content">
                    <div class="tab-header">
                        <h2>‚öîÔ∏è Combat Tracker</h2>
                        <div class="combat-controls" id="dm-combat-controls" style="display: none;">
                            <button id="start-combat-btn" class="btn btn-primary">Start Combat</button>
                            <button id="end-combat-btn" class="btn btn-danger" style="display: none;">End Combat</button>
                            <button id="next-turn-btn" class="btn btn-secondary" style="display: none;">Next Turn</button>
                        </div>
                    </div>
                    
                    <div id="combat-tracker" class="combat-tracker">
                        <div id="combat-status" class="combat-status">
                            <p>Combat is not active</p>
                        </div>
                        
                        <div id="initiative-order" class="initiative-order" style="display: none;">
                            <h3>Initiative Order</h3>
                            <div id="combatants-list" class="combatants-list">
                                <!-- Combatants will be displayed here -->
                            </div>
                        </div>
                        
                        <!-- Player Character Sheet Excerpt -->
                        <div id="player-combat-sheet" class="player-combat-sheet">
                            <h3>Your Character</h3>
                            <div id="player-character-stats">
                                <!-- Player's character combat stats -->
                            </div>
                        </div>
                    </div>

                    <!-- Start Combat Modal -->
                    <div id="combat-setup-modal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>Setup Combat</h3>
                                <span class="close">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div id="combat-setup-characters" class="combat-setup-characters">
                                    <h4>Player Characters</h4>
                                    <div id="pc-combat-list">
                                        <!-- Player characters for combat -->
                                    </div>
                                </div>
                                <div class="combat-setup-enemies">
                                    <h4>Enemies/NPCs</h4>
                                    <button id="add-enemy-btn" class="btn btn-secondary">+ Add Enemy</button>
                                    <div id="enemy-combat-list">
                                        <!-- Enemies for combat -->
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" id="cancel-combat-setup" class="btn btn-secondary">Cancel</button>
                                <button type="button" id="confirm-combat-start" class="btn btn-primary">Start Combat</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Battle Map Tab -->
                <div id="battlemap-tab" class="tab-content">
                    <div class="tab-header">
                        <h2>üó∫Ô∏è Battle Map</h2>
                        <div class="battlemap-controls">
                            <button id="open-battlemap-window" class="btn btn-primary">üì∫ Open in New Window</button>
                            <button id="toggle-grid" class="btn btn-secondary">Toggle Grid</button>
                            <button id="center-map" class="btn btn-secondary">Center Map</button>
                        </div>
                    </div>
                    
                    <div id="battlemap-container" class="battlemap-container">
                        <div id="battlemap-canvas-wrapper" class="battlemap-canvas-wrapper">
                            <canvas id="battlemap-canvas" width="800" height="600"></canvas>
                            <div id="battlemap-tokens" class="battlemap-tokens">
                                <!-- Token elements will be positioned here -->
                            </div>
                        </div>
                        
                        <div class="battlemap-sidebar">
                            <h4>Map Controls</h4>
                            <div class="map-tools">
                                <button class="tool-btn active" data-tool="select">üìç Select</button>
                                <button class="tool-btn" data-tool="move">üèÉ Move</button>
                                <button class="tool-btn" data-tool="measure">üìè Measure</button>
                            </div>
                            
                            <div class="token-list">
                                <h4>Tokens</h4>
                                <div id="token-list-items">
                                    <!-- Tokens listed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DM Book Tab -->
<div id="dm-book-tab" class="tab-content">
    <div class="tab-header">
        <h2>üìñ Chronicles of Shadowmar: DM's Compendium</h2>
        <div class="dm-book-controls" id="dm-book-edit-controls" style="display: none;">
            <button id="edit-chapter-btn" class="btn btn-secondary">‚úèÔ∏è Edit Chapter</button>
            <button id="save-chapter-btn" class="btn btn-primary" style="display: none;">üíæ Save Chapter</button>
            <button id="cancel-edit-btn" class="btn btn-secondary" style="display: none;">‚ùå Cancel</button>
        </div>
    </div>
    
    <div class="dm-book-container">
        <div class="book-navigation">
            <h3>Table of Contents</h3>
            <ul class="book-chapters">
                <li><button class="chapter-btn active" data-section="overview">üåä Campaign Overview</button></li>
                <li><button class="chapter-btn" data-section="sessions">üìú Session Guide</button></li>
                <li><button class="chapter-btn" data-section="xylos">üèõÔ∏è City of Xylos</button></li>
                <li><button class="chapter-btn" data-section="npcs">üë• Major NPCs</button></li>
                <li><button class="chapter-btn" data-section="encounters">‚öîÔ∏è Encounters & Combat</button></li>
                <li><button class="chapter-btn" data-section="weaver_tools">üîÆ Weaver Tools</button></li>
                <li><button class="chapter-btn" data-section="lore">üìö World Lore & Secrets</button></li>
                <li><button class="chapter-btn" data-section="tools">üîß DM Tools & Reference</button></li>
            </ul>
        </div>
        
        <div class="book-content">
            <div class="book-page">
                <div id="book-chapter-content">
                    <div class="loading-book">Loading the ancient tome...</div>
                </div>
                <div id="book-chapter-editor" style="display: none;">
                    <div class="form-group">
                        <label for="chapter-title">Chapter Title</label>
                        <input type="text" id="chapter-title" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="chapter-content">Chapter Content (HTML allowed)</label>
                        <textarea id="chapter-content" rows="20" class="form-control"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Character Sheet Modal -->
    <div id="character-sheet-modal" class="modal character-sheet-modal">
        <div class="modal-content character-sheet-content">
            <div class="modal-header">
                <h3 id="character-sheet-title">Character Sheet</h3>
                <div class="character-sheet-controls">
                    <button id="delete-character-btn" class="btn btn-danger btn-small" style="display: none;">üóëÔ∏è Delete</button>
                    <span class="close">&times;</span>
                </div>
            </div>
            <div class="modal-body character-sheet-body">
                <div class="character-sheet">
                    <!-- Header Section -->
                    <div class="sheet-header">
                        <div class="character-banner">
                            <div class="form-group">
                                <label for="sheet-char-name">Character Name</label>
                                <input type="text" id="sheet-char-name" class="sheet-input large-text" placeholder="Enter character name">
                            </div>
                        </div>
                        
                        <div class="character-basics">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="sheet-class">Class</label>
                                    <input type="text" id="sheet-class" class="sheet-input" placeholder="Fighter">
                                </div>
                                <div class="form-group">
                                    <label for="sheet-level">Level</label>
                                    <input type="number" id="sheet-level" class="sheet-input" min="1" max="20" value="1">
                                </div>
                                <div class="form-group">
                                    <label for="sheet-race">Race</label>
                                    <input type="text" id="sheet-race" class="sheet-input" placeholder="Human">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="sheet-background">Background</label>
                                    <input type="text" id="sheet-background" class="sheet-input" placeholder="Soldier">
                                </div>
                                <div class="form-group">
                                    <label for="sheet-alignment">Alignment</label>
                                    <input type="text" id="sheet-alignment" class="sheet-input" placeholder="Lawful Good">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Character Sheet Layout -->
                    <div class="sheet-main">
                        <!-- Left Column -->
                        <div class="sheet-left">
                            <!-- Ability Scores -->
                            <div class="ability-scores">
                                <h4>üé≤ Ability Scores</h4>
                                <div class="abilities-grid">
                                    <div class="ability-score">
                                        <label>STR</label>
                                        <div class="ability-box">
                                            <input type="number" id="sheet-strength" class="ability-input" min="1" max="30" value="10">
                                            <div class="ability-modifier" id="str-modifier">+0</div>
                                        </div>
                                    </div>
                                    <div class="ability-score">
                                        <label>DEX</label>
                                        <div class="ability-box">
                                            <input type="number" id="sheet-dexterity" class="ability-input" min="1" max="30" value="10">
                                            <div class="ability-modifier" id="dex-modifier">+0</div>
                                        </div>
                                    </div>
                                    <div class="ability-score">
                                        <label>CON</label>
                                        <div class="ability-box">
                                            <input type="number" id="sheet-constitution" class="ability-input" min="1" max="30" value="10">
                                            <div class="ability-modifier" id="con-modifier">+0</div>
                                        </div>
                                    </div>
                                    <div class="ability-score">
                                        <label>INT</label>
                                        <div class="ability-box">
                                            <input type="number" id="sheet-intelligence" class="ability-input" min="1" max="30" value="10">
                                            <div class="ability-modifier" id="int-modifier">+0</div>
                                        </div>
                                    </div>
                                    <div class="ability-score">
                                        <label>WIS</label>
                                        <div class="ability-box">
                                            <input type="number" id="sheet-wisdom" class="ability-input" min="1" max="30" value="10">
                                            <div class="ability-modifier" id="wis-modifier">+0</div>
                                        </div>
                                    </div>
                                    <div class="ability-score">
                                        <label>CHA</label>
                                        <div class="ability-box">
                                            <input type="number" id="sheet-charisma" class="ability-input" min="1" max="30" value="10">
                                            <div class="ability-modifier" id="cha-modifier">+0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Inspiration and Proficiency -->
                            <div class="sheet-section">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="sheet-inspiration">Inspiration</label>
                                        <input type="number" id="sheet-inspiration" class="sheet-input circle-input" min="0" max="1" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="sheet-proficiency">Proficiency Bonus</label>
                                        <input type="number" id="sheet-proficiency" class="sheet-input circle-input" min="2" max="6" value="2">
                                    </div>
                                </div>
                            </div>

                            <!-- Saving Throws -->
                            <div class="sheet-section">
                                <h4>üíæ Saving Throws</h4>
                                <div class="saves-list">
                                    <div class="save-item">
                                        <input type="checkbox" id="save-str-prof" class="save-checkbox">
                                        <span class="save-modifier" id="save-str">+0</span>
                                        <label for="save-str-prof">Strength</label>
                                    </div>
                                    <div class="save-item">
                                        <input type="checkbox" id="save-dex-prof" class="save-checkbox">
                                        <span class="save-modifier" id="save-dex">+0</span>
                                        <label for="save-dex-prof">Dexterity</label>
                                    </div>
                                    <div class="save-item">
                                        <input type="checkbox" id="save-con-prof" class="save-checkbox">
                                        <span class="save-modifier" id="save-con">+0</span>
                                        <label for="save-con-prof">Constitution</label>
                                    </div>
                                    <div class="save-item">
                                        <input type="checkbox" id="save-int-prof" class="save-checkbox">
                                        <span class="save-modifier" id="save-int">+0</span>
                                        <label for="save-int-prof">Intelligence</label>
                                    </div>
                                    <div class="save-item">
                                        <input type="checkbox" id="save-wis-prof" class="save-checkbox">
                                        <span class="save-modifier" id="save-wis">+0</span>
                                        <label for="save-wis-prof">Wisdom</label>
                                    </div>
                                    <div class="save-item">
                                        <input type="checkbox" id="save-cha-prof" class="save-checkbox">
                                        <span class="save-modifier" id="save-cha">+0</span>
                                        <label for="save-cha-prof">Charisma</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Skills -->
                            <div class="sheet-section">
                                <h4>üéØ Skills</h4>
                                <div class="skills-list">
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-acrobatics" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-acrobatics-mod">+0</span>
                                        <label for="skill-acrobatics">Acrobatics (Dex)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-animal-handling" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-animal-handling-mod">+0</span>
                                        <label for="skill-animal-handling">Animal Handling (Wis)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-arcana" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-arcana-mod">+0</span>
                                        <label for="skill-arcana">Arcana (Int)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-athletics" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-athletics-mod">+0</span>
                                        <label for="skill-athletics">Athletics (Str)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-deception" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-deception-mod">+0</span>
                                        <label for="skill-deception">Deception (Cha)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-history" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-history-mod">+0</span>
                                        <label for="skill-history">History (Int)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-insight" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-insight-mod">+0</span>
                                        <label for="skill-insight">Insight (Wis)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-intimidation" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-intimidation-mod">+0</span>
                                        <label for="skill-intimidation">Intimidation (Cha)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-investigation" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-investigation-mod">+0</span>
                                        <label for="skill-investigation">Investigation (Int)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-medicine" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-medicine-mod">+0</span>
                                        <label for="skill-medicine">Medicine (Wis)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-nature" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-nature-mod">+0</span>
                                        <label for="skill-nature">Nature (Int)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-perception" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-perception-mod">+0</span>
                                        <label for="skill-perception">Perception (Wis)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-performance" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-performance-mod">+0</span>
                                        <label for="skill-performance">Performance (Cha)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-persuasion" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-persuasion-mod">+0</span>
                                        <label for="skill-persuasion">Persuasion (Cha)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-religion" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-religion-mod">+0</span>
                                        <label for="skill-religion">Religion (Int)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-sleight-of-hand" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-sleight-of-hand-mod">+0</span>
                                        <label for="skill-sleight-of-hand">Sleight of Hand (Dex)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-stealth" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-stealth-mod">+0</span>
                                        <label for="skill-stealth">Stealth (Dex)</label>
                                    </div>
                                    <div class="skill-item">
                                        <input type="checkbox" id="skill-survival" class="skill-checkbox">
                                        <span class="skill-modifier" id="skill-survival-mod">+0</span>
                                        <label for="skill-survival">Survival (Wis)</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Center Column -->
                        <div class="sheet-center">
                            <!-- Combat Stats -->
                            <div class="combat-stats">
                                <div class="combat-row">
                                    <div class="combat-stat">
                                        <label>Armor Class</label>
                                        <div class="combat-value">
                                            <input type="number" id="sheet-ac" class="combat-input" min="1" value="10">
                                        </div>
                                    </div>
                                    <div class="combat-stat">
                                        <label>Initiative</label>
                                        <div class="combat-value">
                                            <input type="number" id="sheet-initiative" class="combat-input" value="0">
                                        </div>
                                    </div>
                                    <div class="combat-stat">
                                        <label>Speed</label>
                                        <div class="combat-value">
                                            <input type="number" id="sheet-speed" class="combat-input" min="0" value="30">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hit Points -->
                            <div class="hit-points">
                                <h4>‚ù§Ô∏è Hit Points</h4>
                                <div class="hp-section">
                                    <div class="hp-max">
                                        <label>Hit Point Maximum</label>
                                        <input type="number" id="sheet-hp-max" class="hp-input" min="1" value="10">
                                    </div>
                                    <div class="hp-current">
                                        <label>Current Hit Points</label>
                                        <input type="number" id="sheet-hp-current" class="hp-input large" min="0" value="10">
                                    </div>
                                    <div class="hp-temp">
                                        <label>Temporary Hit Points</label>
                                        <input type="number" id="sheet-hp-temp" class="hp-input" min="0" value="0">
                                    </div>
                                </div>
                            </div>

                            <!-- Hit Dice & Death Saves -->
                            <div class="sheet-row">
                                <div class="hit-dice">
                                    <h4>üé≤ Hit Dice</h4>
                                    <div class="hit-dice-section">
                                        <input type="text" id="sheet-hit-dice" class="sheet-input" placeholder="1d10">
                                    </div>
                                </div>
                                <div class="death-saves">
                                    <h4>üíÄ Death Saves</h4>
                                    <div class="death-saves-section">
                                        <div class="saves-row">
                                            <label>Successes</label>
                                            <div class="death-checkboxes">
                                                <input type="checkbox" id="death-success-1" class="death-checkbox">
                                                <input type="checkbox" id="death-success-2" class="death-checkbox">
                                                <input type="checkbox" id="death-success-3" class="death-checkbox">
                                            </div>
                                        </div>
                                        <div class="saves-row">
                                            <label>Failures</label>
                                            <div class="death-checkboxes">
                                                <input type="checkbox" id="death-failure-1" class="death-checkbox">
                                                <input type="checkbox" id="death-failure-2" class="death-checkbox">
                                                <input type="checkbox" id="death-failure-3" class="death-checkbox">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Attacks & Spellcasting -->
                            <div class="attacks-section">
                                <h4>‚öîÔ∏è Attacks & Spellcasting</h4>
                                <textarea id="sheet-attacks" class="sheet-textarea" rows="8" placeholder="Weapon attacks, spell attack bonuses, damage, etc."></textarea>
                            </div>

                            <!-- Equipment -->
                            <div class="equipment-section">
                                <h4>üéí Equipment</h4>
                                <textarea id="sheet-equipment" class="sheet-textarea" rows="6" placeholder="Weapons, armor, adventuring gear, treasure, etc."></textarea>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="sheet-right">
                            <!-- Other Proficiencies & Languages -->
                            <div class="sheet-section">
                                <h4>üó£Ô∏è Languages & Proficiencies</h4>
                                <textarea id="sheet-languages" class="sheet-textarea" rows="4" placeholder="Languages, tool proficiencies, weapon proficiencies, etc."></textarea>
                            </div>

                            <!-- Features & Traits -->
                            <div class="sheet-section">
                                <h4>‚ú® Features & Traits</h4>
                                <textarea id="sheet-features" class="sheet-textarea" rows="8" placeholder="Racial traits, class features, feats, etc."></textarea>
                            </div>

                            <!-- Character Traits -->
                            <div class="character-traits">
                                <div class="trait-section">
                                    <h4>üé≠ Personality Traits</h4>
                                    <textarea id="sheet-personality" class="sheet-textarea" rows="3" placeholder="Describe your character's personality..."></textarea>
                                </div>
                                <div class="trait-section">
                                    <h4>üí° Ideals</h4>
                                    <textarea id="sheet-ideals" class="sheet-textarea" rows="3" placeholder="What drives your character?"></textarea>
                                </div>
                                <div class="trait-section">
                                    <h4>üîó Bonds</h4>
                                    <textarea id="sheet-bonds" class="sheet-textarea" rows="3" placeholder="Important people, places, or things..."></textarea>
                                </div>
                                <div class="trait-section">
                                    <h4>‚ùå Flaws</h4>
                                    <textarea id="sheet-flaws" class="sheet-textarea" rows="3" placeholder="Character weaknesses or vices..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-character-sheet" class="btn btn-secondary">Cancel</button>
                <button type="button" id="save-character-sheet" class="btn btn-primary">üíæ Save Character</button>
            </div>
        </div>
    </div>

    <!-- Simple Character Modal (for quick edits) -->
    <div id="character-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="character-modal-title">Quick Edit Character</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="character-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="char-name">Character Name</label>
                            <input type="text" id="char-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="char-class">Class</label>
                            <input type="text" id="char-class" name="class">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="char-level">Level</label>
                            <input type="number" id="char-level" name="level" min="1" max="20" value="1">
                        </div>
                        <div class="form-group">
                            <label for="char-ac">Armor Class</label>
                            <input type="number" id="char-ac" name="ac" min="1" value="10">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="char-hp-current">Current HP</label>
                            <input type="number" id="char-hp-current" name="hp_current" min="0" value="10">
                        </div>
                        <div class="form-group">
                            <label for="char-hp-max">Max HP</label>
                            <input type="number" id="char-hp-max" name="hp_max" min="1" value="10">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="char-speed">Speed (ft)</label>
                            <input type="number" id="char-speed" name="speed" min="0" value="30">
                        </div>
                        <div class="form-group">
                            <label for="char-initiative">Initiative Modifier</label>
                            <input type="number" id="char-initiative" name="initiative" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="char-notes">Notes</label>
                        <textarea id="char-notes" name="notes" rows="4" placeholder="Character backstory, equipment, etc."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-character" class="btn btn-secondary">Cancel</button>
                <button type="button" id="save-character" class="btn btn-primary">Save Character</button>
            </div>
        </div>
    </div>

    <!-- Secret Message Modal -->
    <div id="secret-message-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìú Send Secret Message</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="secret-recipient">Recipient</label>
                    <select id="secret-recipient" class="form-control">
                        <option value="">Select recipient...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="secret-message-text">Message</label>
                    <textarea id="secret-message-text" rows="4" placeholder="Your secret message..." class="form-control"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-secret-message" class="btn btn-secondary">Cancel</button>
                <button type="button" id="send-secret-message" class="btn btn-primary">Send Message</button>
            </div>
        </div>
    </div>

    <!-- Edit Field Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="edit-modal-title">Edit Field</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="edit-textarea" rows="6"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" id="cancel-edit" class="btn btn-secondary">Cancel</button>
                <button type="button" id="save-edit" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Secret Message Parchment -->
    <div id="secret-parchment" class="secret-parchment" style="display: none;">
        <div class="parchment-content">
            <div class="parchment-header">
                <span class="parchment-from">From: <span id="parchment-sender"></span></span>
                <button class="parchment-close">√ó</button>
            </div>
            <div class="parchment-message" id="parchment-message"></div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="notifications"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
